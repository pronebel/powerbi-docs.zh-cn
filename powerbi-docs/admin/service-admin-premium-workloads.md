---
title: 如何在 Power BI Premium 中配置工作负载
description: 了解如何在 Power BI 高级容量中配置工作负载。
author: davidiseminger
ms.author: davidi
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-premium
ms.topic: how-to
ms.date: 05/11/2020
LocalizationGroup: Premium
ms.openlocfilehash: 3454a10269937d6e03151a64bba6695cc37fcd66
ms.sourcegitcommit: 37bd34053557089c4fbf0e05f78e959609966561
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2020
ms.locfileid: "94396325"
---
# <a name="configure-workloads-in-a-premium-capacity"></a>在高级容量中配置工作负载

本文介绍如何为 Power BI 高级容量启用和配置工作负载。 默认情况下，容量仅支持与正在运行的 Power BI 查询关联的工作负载。 还可以为 [AI（认知服务）](../transform-model/dataflows/dataflows-machine-learning-integration.md)、[数据流](../transform-model/dataflows/dataflows-introduction-self-service.md)和[分页报表](../paginated-reports/paginated-reports-save-to-power-bi-service.md)启用和配置其他工作负载。

## <a name="default-memory-settings"></a>默认内存设置

查询工作负载针对由高级容量 SKU 确定的资源进行优化并受到这些资源的限制。 高级容量还支持可以使用容量资源的其他工作负载。 这些工作负载的默认内存值基于 SKU 可用的容量节点。 最大内存设置不是累计计算的。 为 AI 和数据流动态分配并为分页报表静态分配相当于最大指定值的内存。

|                       | EM1 / A1                  | EM2 / A2                  | EM3 / A3                  | P1 / A4                  | P2 / A5                  | P3 / A6                   |
|-----------------------|---------------------------|---------------------------|---------------------------|--------------------------|--------------------------|---------------------------|
| **AI**                | 不支持               | 默认为 40%，最低为 40%  | 默认为 20%，最低为 20%  | 默认为 20%，最低为 8%  | 默认为 20%，最低为 4%  | 默认为 20%，最低为 2%   |
| **数据集**          | 默认为 100%，最低为 67% | 默认为 100%，最低为 40% | 默认为 100%，最低为 20% | 默认为 100%，最低为 8% | 默认为 100%，最低为 4% | 默认为 100%，最低为 2%  |
| **数据流**         | 默认为 40%，最低为 40%  | 默认为 24%，最低为 24%  | 默认为 20%，最低为 12%  | 默认为 20%，最低为 5%  | 默认为 20%，最低为 3%  | 默认为 20%，最低为 2%   |
| **分页报表** | 不支持               | 不支持               | 不支持               | 默认为 20%，最低为 10% | 默认为 20%，最低为 5%  | 默认为 20%，最低为 2.5% |

## <a name="workload-settings"></a>工作负载设置

### <a name="ai-preview"></a>AI（预览版）

通过 AI 工作负载，可在 Power BI 中使用认知服务和自动机器学习。 使用以下设置控制工作负载行为。

| 设置名称 | 说明 |
|---------------------------------|----------------------------------------|
| **最大内存(%)** | AI 进程可在容量中使用的最大可用内存百分比。 |
| **允许 Power BI Desktop 使用** | 此设置保留以供将来使用，且不会在所有租户中显示。 |
| **允许构建机器学习模型** | 指定业务分析师是否可直接在 Power BI 中训练、验证和调用机器学习模型。 有关详细信息，请参阅 [Power BI 中的自动机器学习（预览）](../transform-model/dataflows/dataflows-machine-learning-integration.md)。 |
| **为 AI 请求启用并行** | 指定 AI 请求是否可并行运行。 |
|  |  |

### <a name="datasets"></a>数据集

数据集工作负载默认启用，且无法禁用。 使用以下设置控制工作负载行为。 对于某些设置，表下方还有其他使用情况信息。

| 设置名称 | 说明 |
|---------------------------------|----------------------------------------|
| **最大内存(%)** | 数据集可在容量中使用的最大内存百分比。 |
| **XMLA 终结点** | 指定来自客户端应用程序的连接采用工作区和应用级别设置的安全组成员身份。 有关详细信息，请参阅[使用客户端应用程序和工具连接到数据集](service-premium-connect-tools.md)。 |
| 最大中间行设置计数 | DirectQuery 返回的最大中间行数。 默认值为 1000000，允许范围为 100000 - 2147483647。 |
| 最大脱机数据集大小 (GB) | 内存中脱机数据集的最大大小。 这是磁盘上的压缩大小。 默认值为 0，这是由 SKU 定义的最大限制。 允许的范围介于 0 和容量大小限制之间。 |
| 最大结果行设置计数 | DAX 查询中返回的最大行数。 默认值为 -1（无限制），允许范围为 100000 - 2147483647。 |
| 查询内存限制(%) | 工作负载中可用于执行 MDX 或 DAX 查询的可用内存的最大百分比。 默认值为 0，这将导致应用特定于 SKU 的自动查询内存限制。 |
| 查询超时值(秒) | 查询超时前允许的最长时间。默认值为 3600 秒（1 小时）。 值为 0 时表示查询不会超时。 |
| **自动页面刷新** | 启用/禁用切换，允许高级工作区的报表基于固定间隔具有自动页面刷新功能。 |
| **最小刷新间隔** | 启用自动页面刷新情况下，页面刷新间隔允许的最小间隔。 默认值为 5 分钟，允许的最小值为 1 秒。 |
| **更改检测度量值** | 启用/禁用切换，允许高级工作区的报表基于更改检测具有自动页面刷新功能。 |
| **最小执行间隔** | 如果更改检测度量值已启用，则允许轮询数据更改的最小执行间隔。 默认值为 5 秒，允许的最小值为 1 秒。 |
|  |  |  |

#### <a name="max-intermediate-row-set-count"></a>最大中间行设置计数

使用此设置可控制资源密集型报表或设计不良报表的影响。 如果对 DirectQuery 数据集的查询导致源数据库产生非常大的结果，则可能会导致内存使用率和处理开销突增。 这种情况可能会导致其他用户和报表资源不足。 使用此设置，容量管理员可以调整单个查询可从数据源中提取的行数。

或者，如果容量可以支持的默认值超过一百万行，并且你有一个大型数据集，则增加此设置以提取更多行。

请注意，此设置仅影响 DirectQuery 查询，而[最大结果行设置计数](#max-result-row-set-count)会影响 DAX 查询。

#### <a name="max-offline-dataset-size"></a>最大脱机数据集大小

使用此设置可防止报表创建者发布可能对容量产生负面影响的大型数据集。 请注意，在将数据集加载到内存中之前，Power BI 无法确定实际的内存中大小。 脱机大小较小的数据集的内存占用情况可能比脱机大小较大的数据集更大。

如果现有数据集大于为此设置指定的大小，则当用户尝试访问该数据集时，该数据集将无法加载。 如果数据集大于为数据集工作负载配置的最大内存，则数据集也可能无法加载。

为了保护系统的性能，不管配置什么值，都会为最大脱机数据集大小应用额外的特定于 SKU 的硬上限。 此硬上限不适用于为大型数据优化的 Power BI 数据集。 有关详细信息，请参阅 [Power BI Premium 中的大型模型](service-premium-large-models.md)。

|                                               | EM1 / A1 | EM2 / A2 | EM3 / A3 | P1 / A4 | P2 / A5 | P3 / A6 |
|-----------------------------------------------|----------|----------|----------|---------|---------|---------|
| **最大脱机数据集大小的硬上限** | 3 GB     | 5 GB     | 6 GB     | 10GB   | 10GB   | 10GB   |

#### <a name="max-result-row-set-count"></a>最大结果行设置计数

使用此设置可控制资源密集型报表或设计不良报表的影响。 如果在 DAX 查询中达到此限制，报表用户将看到以下错误。 他们应复制错误详细信息并与管理员联系。

![无法加载此视觉对象的数据](media/service-admin-premium-workloads/could-not-load-data.png)

请注意，此设置仅影响 DAX 查询，而[最大中间行设置计数](#max-intermediate-row-set-count)会影响 DirectQuery 查询。

#### <a name="query-memory-limit"></a>查询内存限制

使用此设置可控制资源密集型报表或设计不良报表的影响。 某些查询和计算可能会导致使用大量容量内存的中间结果。 这种情况可能会导致其他查询的执行速度非常缓慢，导致其他数据集从容量中逐出，并导致使用容量的其他用户出现内存不足错误。

此设置适用于 Power BI 报表、“在 Excel 中分析”报表以及其他可能通过 XMLA 终结点进行连接的工具执行的所有 DAX 和 MDX 查询。

请注意，数据刷新操作还可以在刷新数据集中的数据后，在刷新仪表板磁贴和可视化缓存的过程中执行 DAX 查询。 此类查询可能还会因为此设置而失败，这可能会导致数据刷新操作显示为失败状态，即使数据集中的数据已成功更新。

默认设置为 0，这将导致应用以下特定于 SKU 的自动查询内存限制。

|                                  | EM1 / A1 | EM2 / A2 | EM3 / A3 | P1 / A4 | P2 / A5 | P3 / A6 |
|----------------------------------|----------|----------|----------|---------|---------|---------|
| **自动查询内存限制** | 1GB     | 2 GB     | 2 GB     | 6 GB    | 6 GB    | 10GB   |

为了保护系统的性能，对 Power BI 报表执行的所有查询都强制执行 10 GB 的硬上限，而不考虑用户配置的查询内存限制。 此硬上限不适用于使用 Analysis Services 协议（也称为 XMLA）的工具发出的查询。 如果查询占用过多内存，则用户应考虑简化查询或其计算。

#### <a name="query-timeout"></a>查询超时

使用此设置可以更好地控制长时间运行的查询，此类查询可能会导致用户加载报表速度缓慢。

此设置适用于 Power BI 报表、“在 Excel 中分析”报表以及其他可能通过 XMLA 终结点进行连接的工具执行的所有 DAX 和 MDX 查询。

请注意，数据刷新操作还可以在刷新数据集中的数据后，在刷新仪表板磁贴和可视化缓存的过程中执行 DAX 查询。 此类查询可能还会因为此设置而失败，这可能会导致数据刷新操作显示为失败状态，即使数据集中的数据已成功更新。

此设置适用于单个查询，而不适用于运行与更新数据集或报表相关联的所有查询所用的时间长度。 请考虑以下示例：

- “查询超时”设置为 1200（20 分钟）。
- 需要执行五个查询，每个查询运行 15 分钟。

所有查询的合并时间为 75 分钟，但由于所有单个查询运行的时间少于 20 分钟，因此不会达到设置限制。

请注意，Power BI 报表将覆盖此默认设置，并大大降低对容量的每个查询的超时值。 每个查询的超时值通常约为三分钟。

#### <a name="automatic-page-refresh-preview"></a>自动页面刷新（预览版）

启用时，借助自动页面刷新功能，高级容量中的用户可以按定义的时间间隔为 DirectQuery 源刷新报表中的页面。 容量管理员可以执行以下操作：

- 启用和禁用自动页面刷新
- 定义最小刷新间隔

下图显示了自动刷新间隔设置的位置：

![自动刷新间隔的管理员设置](media/service-admin-premium-workloads/automatic-refresh-interval.png)

自动页面刷新创建的查询会直接转到数据源，因此，在组织中允许自动页面刷新时，请务必考虑这些源的可靠性和负载。 

### <a name="dataflows"></a>数据流

通过数据流工作负载，可使用数据流自助数据准备功能来引入、转换、集成和扩充数据。 使用以下设置控制工作负载行为。

| 设置名称 | 说明 |
|---------------------------------|----------------------------------------|
| **最大内存(%)** | 数据流可在容量中使用的最大内存百分比。 |
| **增强的数据流计算引擎(预览版)** | 处理大规模数据量时，启用此选项可使计算实体的计算速度提高 20 倍。 **必须重启容量才能激活新引擎。** 有关详细信息，请参阅[增强的数据流计算引擎](#enhanced-dataflows-compute-engine)。 |
| **容器大小** | 数据流用于数据流中各实体的容器的最大大小。 默认值为 700 MB。 有关详细信息，请参阅[容器大小](#container-size)。 |
|  |  |

#### <a name="enhanced-dataflows-compute-engine"></a>增强的数据流计算引擎

为利用新计算引擎的优势，请将数据引入拆分到单独的数据流，并将转换逻辑置于不同数据流中的计算实体中。 推荐采用此方法，因为计算引擎处理引用现有数据流的数据流。 它不处理引入数据流。 遵循本指导可确保新计算引擎处理连接和合并等转换步骤时具备最优性能。

#### <a name="container-size"></a>容器大小

刷新数据流时，数据流工作负载会为数据流中的每个实体生成容器。 每个容器可占用的内存不得超过“容器大小”设置中指定的内存量。 所有 SKU 的默认值均为 700 MB。 如果有以下情况，可能需要更改此设置：

- 数据流刷新时间过长，或者数据流在超时时刷新失败。
- 数据流实体包括联接等计算步骤。  

建议使用 [Power BI Premium 容量指标](service-admin-premium-monitor-capacity.md)应用来分析数据流工作负载的性能。

某些情况下，增加容器大小可能不会提高性能。 例如，如果数据流仅是从源获取数据，而不执行大量计算，那么更改容器大小可能不会有所帮助。 如果增加容器大小使数据流工作负载可以为实体刷新操作分配更多内存，那么这么做可能会有所帮助。 通过分配更多内存，可以减少刷新计算量很大的实体所需的时间。

“容器大小”值不能超过“数据流”工作负载的最大内存。 例如，P1 容量具有 25 GB 内存。 如果“数据流”工作负载“最大内存(%)” 设置为 20%，则“容器大小(MB)”不能超过 5000。 任何情况下，即便设置了更大的值，“容器大小”也无法超过“最大内存”。

### <a name="paginated-reports"></a>分页报表

通过分页报表工作负载，可在 Power BI 服务中基于标准 SQL Server Reporting Services 格式运行分页报表。 使用以下设置控制工作负载行为。

| 设置名称 | 说明 |
|---------------------------------|----------------------------------------|
| **最大内存(%)** | 分页报表可在容量中使用的最大内存百分比。 |
|  |  |

分页报表提供了与现在的 SQL Server Reporting Services (SSRS) 报表相同的功能，包括允许报表作者添加自定义代码。  这使作者可以动态地更改报表，例如根据代码表达式更改文本颜色。  为确保适当的隔离，分页报表在受保护的沙盒中按容量运行。 以相同容量运行的报表可能会导致它们之间的副作用。 就像限制哪些作者能够将内容发布到 SSRS 实例一样，建议对分页报表也进行限制。 请确保将内容发布到容量的作者受到组织的信任。 可以通过预配多个容量并为每个容量分配不同的作者来进一步保护环境。 

某些情况下，分页报表工作负载可能变得不可用。 在这种情况下，工作负载在管理门户中显示错误状态，并且用户会看到报表呈现的超时。 要缓解此问题，请禁用工作负载，然后再次启用它。

## <a name="configure-workloads"></a>配置工作负载

通过仅在需要时启用工作负载，最大限度地利用容量的可用资源。 仅在已确定默认设置不满足容量资源要求时更改内存和其他设置。

### <a name="to-configure-workloads-in-the-power-bi-admin-portal"></a>在 Power BI 管理门户中配置工作负载

1. 在“容量设置” > “高级容量”中，选择一个容量 。

1. 在“更多选项”下，展开“工作负载”。

1. 启用一个或多个工作负载，并设置“最大内存”和其他设置的值。

1. 选择 **应用** 。

### <a name="rest-api"></a>REST API

可以使用[容量](/rest/api/power-bi/capacities) REST API 启用工作负载并将其分配给容量。

## <a name="monitoring-workloads"></a>监视工作负载

[Power BI Premium 容量指标应用](service-admin-premium-monitor-capacity.md)提供数据集、数据流和分页报表指标，以监视为容量启用的工作负载。 


> [!IMPORTANT]
> 如果 Power BI Premium 容量遇到资源使用量过高的情况，从而导致性能或可靠性问题，可通过接收通知电子邮件来识别和解决问题。 这可以充当一种用于排查重载容量的简化方法。 有关详细信息，请参阅[容量和可靠性通知](service-interruption-notifications.md#capacity-and-reliability-notifications)。


## <a name="next-steps"></a>后续步骤

[优化 Power BI Premium 容量](service-premium-capacity-optimize.md)
 [Power BI 中的数据流自助服务数据准备](../transform-model/dataflows/dataflows-introduction-self-service.md)
 [Power BI Premium 中的分页报表是什么？](../paginated-reports/paginated-reports-report-builder-power-bi.md)
 [Power BI Desktop 中的自动页面刷新（预览）](../create-reports/desktop-automatic-page-refresh.md)

更多问题？ [在 Power BI 社区提问](https://community.powerbi.com/)